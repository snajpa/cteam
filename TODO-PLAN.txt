# oteam Redesign Plan
# Generated: 2026-01-15
# Based on TODO.txt analysis

================================================================================
MASTER SCHEDULE (8 weeks)
================================================================================

Week 1: Core ticket flow
Week 2: Context + Plan mode
Week 3: Coordination layer
Week 4: Safety + Quality
Week 5-6: Reviews + polish
Week 7-8: Testing + docs

================================================================================
WEEK 1: SELF-ASSIGNMENT SYSTEM (Priority: HIGHEST)
================================================================================

[x] Day 1: `oteam tickets list --ready` - COMPLETE
    [x] Create oteam/cmd/tickets/list.py
    [x] Create oteam/state/tickets.py
    [x] Create oteam/state/tickets_test.py
    [x] Implement list ready tickets query

[x] Day 2-3: `oteam ticket-grab` core - COMPLETE
    [x] Create oteam/cmd/ticket_grab.py
    [x] Create oteam/cmd/ticket_grab_test.py
    [x] Implement self-assign logic

[ ] Day 4: Assignee locking + integration test
    [ ] Full manual verification of ticket-grab flow

FILES TO CREATE Week 1:
oteam/
├── cmd/
│   ├── tickets/
│   │   ├── __init__.py
│   │   ├── list.py
│   │   └── list_test.py
│   ├── ticket_grab.py
│   └── ticket_grab_test.py
├── state/
│   ├── __init__.py
│   ├── tickets.py
│   └── tickets_test.py
└── oteam.py (CLI entry point)

================================================================================
WEEK 2: CONTEXT + PLAN MODE - COMPLETE ✓
================================================================================

[x] Day 1: Context template
    [x] Create oteam/ctx/templates/ticket_context.md
    [x] Design 50-line context structure

[x] Day 2: Context generation
    [x] Create oteam/ctx/inject.py
    [x] Create oteam/ctx/inject_test.py
    [x] Implement context file generation

[x] Day 3: Mode detection
    [x] Create oteam/tmux/detect_mode.py
    [x] Create oteam/tmux/detect_mode_test.py
    [x] Implement Plan vs Build detection

[x] Day 4: Tab switching + integration
    [x] Create oteam/tmux/send_keys.py
    [x] Create oteam/tmux/send_keys_test.py
    [x] Implement Tab key sending

FILES CREATED Week 2:
oteam_pkg/
├── ctx/
│   ├── __init__.py
│   ├── inject.py
│   ├── inject_test.py
│   └── templates/
│       └── ticket_context.md
└── tmux/
    ├── __init__.py
    ├── detect_mode.py
    ├── detect_mode_test.py
    ├── send_keys.py
    └── send_keys_test.py

FILES TO CREATE Week 2:
oteam/
├── ctx/
│   ├── __init__.py
│   ├── inject.py
│   ├── inject_test.py
│   └── templates/
│       └── ticket_context.md
└── tmux/
    ├── __init__.py
    ├── detect_mode.py
    ├── detect_mode_test.py
    ├── send_keys.py
    └── send_keys_test.py

================================================================================
WEEK 3: COORDINATION LAYER - COMPLETE ✓
================================================================================

[x] Day 1-2: Broadcast system
    [x] Create oteam/coord/broadcast.py
    [x] Create oteam/coord/broadcast_test.py
    [x] Implement file-based agent messaging

[x] Day 3: Activity stream
    [x] Create oteam/coord/activity.py
    [x] Create oteam/coord/activity_test.py
    [x] Implement activity logging
    [x] Create oteam/coord/stream.py
    [x] Implement real-time stream CLI

[x] Day 4: "What changed" summary
    [x] Create oteam/coord/file_history.py
    [x] Create oteam/coord/file_history_test.py
    [x] Implement recent changes summary

FILES CREATED Week 3:
oteam_pkg/
└── coord/
    ├── __init__.py
    ├── broadcast.py              # 11 tests
    ├── broadcast_test.py
    ├── activity.py               # 13 tests
    ├── activity_test.py
    ├── stream.py                 # (no tests - CLI only)
    └── file_history.py           # 12 tests
    └── file_history_test.py

================================================================================
WEEK 4: SAFETY + QUALITY - COMPLETE ✓
================================================================================

[x] Day 1-2: Pre-push check
    [x] Create oteam/safety/pre_push.py
    [x] Create oteam/safety/pre_push_test.py
    [x] Implement conflict detection

[x] Day 3-4: Git hooks
    [x] Create oteam/hooks/post-update
    [x] Create oteam/hooks/post-receive
    [x] Implement dependency notification
    [x] Implement CI auto-close trigger

FILES CREATED Week 4:
oteam_pkg/
├── safety/
│   ├── __init__.py
│   ├── pre_push.py              # 14 tests
│   ├── pre_push_test.py
│   └── stuck.py                 # Stuck flag for agents
└── hooks/
    ├── post-update              # Dependency notification
    └── post-receive             # CI auto-close trigger

================================================================================
WHAT TO SKIP (My Taste)
================================================================================

[ ] Review system - Can add later, doesn't block core flow
[ ] Suspend/resume - Future consideration, depends on OpenCode support
[ ] Migration script - Do when someone needs to migrate
[ ] AGENTS.md replacement - Document after system works

================================================================================
ROLLBACK PLAN
================================================================================

- Keep `oteam tickets assign` working until `oteam ticket-grab` is verified
- Test coverage target: 80% on core logic
- Manual verification: Every week ends with human running full flow

================================================================================
OPEN QUESTIONS (To answer before implementing)
================================================================================

[ ] Where does ticket DB live? (SQLite? JSON files? Existing system?)
[ ] Git branch naming convention? (Using agent/{agent}/{ticket})
[ ] Keep or replace old `oteam tickets assign` command?

================================================================================
STATUS TRACKER
================================================================================

Week 1: [COMPLETE] ✓ - Self-assignment system
Week 2: [COMPLETE] ✓ - Context + Plan mode
Week 3: [COMPLETE] ✓ - Coordination layer
Week 4: [COMPLETE] ✓ - Safety + Quality

================================================================================
ALL MILESTONES COMPLETE - oteam Redesign Implemented
================================================================================
